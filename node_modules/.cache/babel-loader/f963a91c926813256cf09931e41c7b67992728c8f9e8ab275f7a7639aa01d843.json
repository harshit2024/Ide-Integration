{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.File = exports.Link = exports.Node = exports.SEP = void 0;\nconst process_1 = require(\"./process\");\nconst buffer_1 = require(\"./internal/buffer\");\nconst constants_1 = require(\"./constants\");\nconst events_1 = require(\"events\");\nconst Stats_1 = require(\"./Stats\");\nconst {\n  S_IFMT,\n  S_IFDIR,\n  S_IFREG,\n  S_IFLNK,\n  O_APPEND\n} = constants_1.constants;\nconst getuid = () => {\n  var _a, _b;\n  return (_b = (_a = process_1.default.getuid) === null || _a === void 0 ? void 0 : _a.call(process_1.default)) !== null && _b !== void 0 ? _b : 0;\n};\nconst getgid = () => {\n  var _a, _b;\n  return (_b = (_a = process_1.default.getgid) === null || _a === void 0 ? void 0 : _a.call(process_1.default)) !== null && _b !== void 0 ? _b : 0;\n};\nexports.SEP = '/';\n/**\n * Node in a file system (like i-node, v-node).\n */\nclass Node extends events_1.EventEmitter {\n  constructor(ino, perm = 0o666) {\n    super();\n    // User ID and group ID.\n    this._uid = getuid();\n    this._gid = getgid();\n    this._atime = new Date();\n    this._mtime = new Date();\n    this._ctime = new Date();\n    this._perm = 0o666; // Permissions `chmod`, `fchmod`\n    this.mode = S_IFREG; // S_IFDIR, S_IFREG, etc.. (file by default?)\n    // Number of hard links pointing at this Node.\n    this._nlink = 1;\n    this._perm = perm;\n    this.mode |= perm;\n    this.ino = ino;\n  }\n  set ctime(ctime) {\n    this._ctime = ctime;\n  }\n  get ctime() {\n    return this._ctime;\n  }\n  set uid(uid) {\n    this._uid = uid;\n    this.ctime = new Date();\n  }\n  get uid() {\n    return this._uid;\n  }\n  set gid(gid) {\n    this._gid = gid;\n    this.ctime = new Date();\n  }\n  get gid() {\n    return this._gid;\n  }\n  set atime(atime) {\n    this._atime = atime;\n    this.ctime = new Date();\n  }\n  get atime() {\n    return this._atime;\n  }\n  set mtime(mtime) {\n    this._mtime = mtime;\n    this.ctime = new Date();\n  }\n  get mtime() {\n    return this._mtime;\n  }\n  set perm(perm) {\n    this._perm = perm;\n    this.ctime = new Date();\n  }\n  get perm() {\n    return this._perm;\n  }\n  set nlink(nlink) {\n    this._nlink = nlink;\n    this.ctime = new Date();\n  }\n  get nlink() {\n    return this._nlink;\n  }\n  getString(encoding = 'utf8') {\n    this.atime = new Date();\n    return this.getBuffer().toString(encoding);\n  }\n  setString(str) {\n    // this.setBuffer(bufferFrom(str, 'utf8'));\n    this.buf = (0, buffer_1.bufferFrom)(str, 'utf8');\n    this.touch();\n  }\n  getBuffer() {\n    this.atime = new Date();\n    if (!this.buf) this.setBuffer((0, buffer_1.bufferAllocUnsafe)(0));\n    return (0, buffer_1.bufferFrom)(this.buf); // Return a copy.\n  }\n  setBuffer(buf) {\n    this.buf = (0, buffer_1.bufferFrom)(buf); // Creates a copy of data.\n    this.touch();\n  }\n  getSize() {\n    return this.buf ? this.buf.length : 0;\n  }\n  setModeProperty(property) {\n    this.mode = this.mode & ~S_IFMT | property;\n  }\n  setIsFile() {\n    this.setModeProperty(S_IFREG);\n  }\n  setIsDirectory() {\n    this.setModeProperty(S_IFDIR);\n  }\n  setIsSymlink() {\n    this.setModeProperty(S_IFLNK);\n  }\n  isFile() {\n    return (this.mode & S_IFMT) === S_IFREG;\n  }\n  isDirectory() {\n    return (this.mode & S_IFMT) === S_IFDIR;\n  }\n  isSymlink() {\n    // return !!this.symlink;\n    return (this.mode & S_IFMT) === S_IFLNK;\n  }\n  makeSymlink(steps) {\n    this.symlink = steps;\n    this.setIsSymlink();\n  }\n  write(buf, off = 0, len = buf.length, pos = 0) {\n    if (!this.buf) this.buf = (0, buffer_1.bufferAllocUnsafe)(0);\n    if (pos + len > this.buf.length) {\n      const newBuf = (0, buffer_1.bufferAllocUnsafe)(pos + len);\n      this.buf.copy(newBuf, 0, 0, this.buf.length);\n      this.buf = newBuf;\n    }\n    buf.copy(this.buf, pos, off, off + len);\n    this.touch();\n    return len;\n  }\n  // Returns the number of bytes read.\n  read(buf, off = 0, len = buf.byteLength, pos = 0) {\n    this.atime = new Date();\n    if (!this.buf) this.buf = (0, buffer_1.bufferAllocUnsafe)(0);\n    let actualLen = len;\n    if (actualLen > buf.byteLength) {\n      actualLen = buf.byteLength;\n    }\n    if (actualLen + pos > this.buf.length) {\n      actualLen = this.buf.length - pos;\n    }\n    const buf2 = buf instanceof Buffer ? buf : Buffer.from(buf.buffer);\n    this.buf.copy(buf2, off, pos, pos + actualLen);\n    return actualLen;\n  }\n  truncate(len = 0) {\n    if (!len) this.buf = (0, buffer_1.bufferAllocUnsafe)(0);else {\n      if (!this.buf) this.buf = (0, buffer_1.bufferAllocUnsafe)(0);\n      if (len <= this.buf.length) {\n        this.buf = this.buf.slice(0, len);\n      } else {\n        const buf = (0, buffer_1.bufferAllocUnsafe)(len);\n        this.buf.copy(buf);\n        buf.fill(0, this.buf.length);\n        this.buf = buf;\n      }\n    }\n    this.touch();\n  }\n  chmod(perm) {\n    this.perm = perm;\n    this.mode = this.mode & ~0o777 | perm;\n    this.touch();\n  }\n  chown(uid, gid) {\n    this.uid = uid;\n    this.gid = gid;\n    this.touch();\n  }\n  touch() {\n    this.mtime = new Date();\n    this.emit('change', this);\n  }\n  canRead(uid = getuid(), gid = getgid()) {\n    if (this.perm & 4 /* S.IROTH */) {\n      return true;\n    }\n    if (gid === this.gid) {\n      if (this.perm & 32 /* S.IRGRP */) {\n        return true;\n      }\n    }\n    if (uid === this.uid) {\n      if (this.perm & 256 /* S.IRUSR */) {\n        return true;\n      }\n    }\n    return false;\n  }\n  canWrite(uid = getuid(), gid = getgid()) {\n    if (this.perm & 2 /* S.IWOTH */) {\n      return true;\n    }\n    if (gid === this.gid) {\n      if (this.perm & 16 /* S.IWGRP */) {\n        return true;\n      }\n    }\n    if (uid === this.uid) {\n      if (this.perm & 128 /* S.IWUSR */) {\n        return true;\n      }\n    }\n    return false;\n  }\n  del() {\n    this.emit('delete', this);\n  }\n  toJSON() {\n    return {\n      ino: this.ino,\n      uid: this.uid,\n      gid: this.gid,\n      atime: this.atime.getTime(),\n      mtime: this.mtime.getTime(),\n      ctime: this.ctime.getTime(),\n      perm: this.perm,\n      mode: this.mode,\n      nlink: this.nlink,\n      symlink: this.symlink,\n      data: this.getString()\n    };\n  }\n}\nexports.Node = Node;\n/**\n * Represents a hard link that points to an i-node `node`.\n */\nclass Link extends events_1.EventEmitter {\n  get steps() {\n    return this._steps;\n  }\n  // Recursively sync children steps, e.g. in case of dir rename\n  set steps(val) {\n    this._steps = val;\n    for (const [child, link] of this.children.entries()) {\n      if (child === '.' || child === '..') {\n        continue;\n      }\n      link === null || link === void 0 ? void 0 : link.syncSteps();\n    }\n  }\n  constructor(vol, parent, name) {\n    super();\n    this.children = new Map();\n    // Path to this node as Array: ['usr', 'bin', 'node'].\n    this._steps = [];\n    // \"i-node\" number of the node.\n    this.ino = 0;\n    // Number of children.\n    this.length = 0;\n    this.vol = vol;\n    this.parent = parent;\n    this.name = name;\n    this.syncSteps();\n  }\n  setNode(node) {\n    this.node = node;\n    this.ino = node.ino;\n  }\n  getNode() {\n    return this.node;\n  }\n  createChild(name, node = this.vol.createNode()) {\n    const link = new Link(this.vol, this, name);\n    link.setNode(node);\n    if (node.isDirectory()) {\n      link.children.set('.', link);\n      link.getNode().nlink++;\n    }\n    this.setChild(name, link);\n    return link;\n  }\n  setChild(name, link = new Link(this.vol, this, name)) {\n    this.children.set(name, link);\n    link.parent = this;\n    this.length++;\n    const node = link.getNode();\n    if (node.isDirectory()) {\n      link.children.set('..', this);\n      this.getNode().nlink++;\n    }\n    this.getNode().mtime = new Date();\n    this.emit('child:add', link, this);\n    return link;\n  }\n  deleteChild(link) {\n    const node = link.getNode();\n    if (node.isDirectory()) {\n      link.children.delete('..');\n      this.getNode().nlink--;\n    }\n    this.children.delete(link.getName());\n    this.length--;\n    this.getNode().mtime = new Date();\n    this.emit('child:delete', link, this);\n  }\n  getChild(name) {\n    this.getNode().mtime = new Date();\n    return this.children.get(name);\n  }\n  getPath() {\n    return this.steps.join(exports.SEP);\n  }\n  getName() {\n    return this.steps[this.steps.length - 1];\n  }\n  // del() {\n  //     const parent = this.parent;\n  //     if(parent) {\n  //         parent.deleteChild(link);\n  //     }\n  //     this.parent = null;\n  //     this.vol = null;\n  // }\n  /**\n   * Walk the tree path and return the `Link` at that location, if any.\n   * @param steps {string[]} Desired location.\n   * @param stop {number} Max steps to go into.\n   * @param i {number} Current step in the `steps` array.\n   *\n   * @return {Link|null}\n   */\n  walk(steps, stop = steps.length, i = 0) {\n    if (i >= steps.length) return this;\n    if (i >= stop) return this;\n    const step = steps[i];\n    const link = this.getChild(step);\n    if (!link) return null;\n    return link.walk(steps, stop, i + 1);\n  }\n  toJSON() {\n    return {\n      steps: this.steps,\n      ino: this.ino,\n      children: Array.from(this.children.keys())\n    };\n  }\n  syncSteps() {\n    this.steps = this.parent ? this.parent.steps.concat([this.name]) : [this.name];\n  }\n}\nexports.Link = Link;\n/**\n * Represents an open file (file descriptor) that points to a `Link` (Hard-link) and a `Node`.\n */\nclass File {\n  /**\n   * Open a Link-Node pair. `node` is provided separately as that might be a different node\n   * rather the one `link` points to, because it might be a symlink.\n   * @param link\n   * @param node\n   * @param flags\n   * @param fd\n   */\n  constructor(link, node, flags, fd) {\n    this.link = link;\n    this.node = node;\n    this.flags = flags;\n    this.fd = fd;\n    this.position = 0;\n    if (this.flags & O_APPEND) this.position = this.getSize();\n  }\n  getString(encoding = 'utf8') {\n    return this.node.getString();\n  }\n  setString(str) {\n    this.node.setString(str);\n  }\n  getBuffer() {\n    return this.node.getBuffer();\n  }\n  setBuffer(buf) {\n    this.node.setBuffer(buf);\n  }\n  getSize() {\n    return this.node.getSize();\n  }\n  truncate(len) {\n    this.node.truncate(len);\n  }\n  seekTo(position) {\n    this.position = position;\n  }\n  stats() {\n    return Stats_1.default.build(this.node);\n  }\n  write(buf, offset = 0, length = buf.length, position) {\n    if (typeof position !== 'number') position = this.position;\n    const bytes = this.node.write(buf, offset, length, position);\n    this.position = position + bytes;\n    return bytes;\n  }\n  read(buf, offset = 0, length = buf.byteLength, position) {\n    if (typeof position !== 'number') position = this.position;\n    const bytes = this.node.read(buf, offset, length, position);\n    this.position = position + bytes;\n    return bytes;\n  }\n  chmod(perm) {\n    this.node.chmod(perm);\n  }\n  chown(uid, gid) {\n    this.node.chown(uid, gid);\n  }\n}\nexports.File = File;","map":{"version":3,"names":["process_1","require","buffer_1","constants_1","events_1","Stats_1","S_IFMT","S_IFDIR","S_IFREG","S_IFLNK","O_APPEND","constants","getuid","_a","_b","default","call","getgid","exports","SEP","Node","EventEmitter","constructor","ino","perm","_uid","_gid","_atime","Date","_mtime","_ctime","_perm","mode","_nlink","ctime","uid","gid","atime","mtime","nlink","getString","encoding","getBuffer","toString","setString","str","buf","bufferFrom","touch","setBuffer","bufferAllocUnsafe","getSize","length","setModeProperty","property","setIsFile","setIsDirectory","setIsSymlink","isFile","isDirectory","isSymlink","makeSymlink","steps","symlink","write","off","len","pos","newBuf","copy","read","byteLength","actualLen","buf2","Buffer","from","buffer","truncate","slice","fill","chmod","chown","emit","canRead","canWrite","del","toJSON","getTime","data","Link","_steps","val","child","link","children","entries","syncSteps","vol","parent","name","Map","setNode","node","getNode","createChild","createNode","set","setChild","deleteChild","delete","getName","getChild","get","getPath","join","walk","stop","i","step","Array","keys","concat","File","flags","fd","position","seekTo","stats","build","offset","bytes"],"sources":["../src/node.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}